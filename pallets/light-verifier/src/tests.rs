use super::*;
use crate as pallet_light_verifier;
use crate::mock::{Test, *};
use webb_proposals::TypedChainId;

use frame_support::assert_ok;

use pallet_eth2_light_client::tests::{get_test_context, submit_and_check_execution_headers};
use sp_core::H256;
use sp_runtime::AccountId32;
use webb_proposals::{self};

pub const GOERLI_CHAIN: TypedChainId = TypedChainId::Evm(5);
pub const ALICE: AccountId32 = AccountId32::new([1u8; 32]);

#[test]
fn test_verify_storage_proof_positive_case() {
	new_test_ext().execute_with(|| {
	// prep light client pallet
	let (headers, updates, _init_input) = get_test_context(None);
	assert_ok!(Eth2Client::submit_beacon_chain_light_client_update(
		RuntimeOrigin::signed(ALICE),
		GOERLI_CHAIN,
		updates[1].clone()
	));

	submit_and_check_execution_headers(
		pallet_eth2_light_client::mock::RuntimeOrigin::signed(ALICE),
		GOERLI_CHAIN,
		headers[0].iter().skip(1).rev().collect(),
	);

	let mut header = headers[0][1].clone();
	let _block_hash = pallet_eth2_light_client::FinalizedExecutionBlocks::<Test>::get(
		GOERLI_CHAIN,
		header.number,
	);

	let hex = "26ef925110ffd83caba0e1df30bf83763582fb8bafa28751cb86610cb1fc616c";
	header.hash = Some(eth_types::H256(array_bytes::hex_n_into::<H256, 32>(hex).unwrap()));

	let key : Vec<u8> = "9c7fca54b386399991ce2d6f6fbfc3879e4204c469d179ec0bba12523ed3d44c".as_bytes().to_vec();
	let proof : Vec<Vec<u8>> = vec![
            "f90211a0101e7ce14617e3b6d6fdba3fadb2725614adf6958a0a94c80f850663e3e11b27a0c7fae9be4cd2575a8d72442e649bd8e8e054a107085600e75170833814b012e3a03e60da2bf49fe4e71073808fc95016bb0dc5bf0103fcc01fd425cde6333e373ca0e48c50d9e1323361e1ddfb0246f9e8094114f480630743d5d20f8dc8f2c36c1aa0bb842ad10edf0a152bbda602192445e1ac656cee50d57aac4ed92f7f2a624daba08f7e00bbebf5dd7c0e951c36c0308be76a71381f6aecf61b2b95f28483aeca6fa09691f7468c11acc8fcc60034a0c1a054e551b79fbb360e9edf53359cc297c71ca0355e7b555a9e0290607cca37367afde2aa59e71585dc5459b54b3c23f456e024a0f141f94285bdcd0658736ba8d3971b41e311d7bc4d69163e7a2f47a6f1544439a0f688b9b16c405efaecdb7ee97d77f07cc92d3597f6c678b37c3d10ecd190d1e4a06341f0935b4e55160b8a4cd990b6da62fc17dc895868ff2b24b9d0e2d51e6b5ba060ba1049e44915d9884d5297737e8f50926a2fe1333908ed4408ce7985b62ac9a0fd5d6445fd7f584879695bdb9aecca3bc3b32cf6fffd823c59b1233b34458db5a03e16aa29f3fa3d88cd43d553029bf5b2a6a8caccc458f0485248b02d5d350858a083e9f5b325bd2f46b57278f76167340dc62f36d03cf0c283ede85cfd2a7b5879a078f5f3a00d5e4c052c38f90fe95d0003ffc887b352c6543acb4c1dae7e9c4d2080".as_bytes().to_vec(),
            "f90211a06b3e9b4c4a9f3b35235f041dc87d102c0d61210a596d215247a6f0e21c112e3fa0ac3d3591317f3a9149973cd750449e4647f237a0e6c6285e52baa755725c50b6a0bc77317fdb363ada827f141e272b1d3887c2c44d1994529ed5a2c851f506c43fa0a992425aad8ece0f639b2ec37bb25a77b1f264ad690800d4221047086e76ad40a0624666b28e7f9fd208d44c7b8a1e370c9d0eac2dd4d120508469806e99bc562ba052a6d2a2ec167ae0a1fe49f2356e3093a90cc7d3296236f35115300e76cda21ca05d5c3e4c9177224ed73c98af3713b6578f182c2301a0d049b843595882da3cb2a0aaba7adc9c55d6a39d6d9a15e06703087aaa4315555781317a992c466b22a108a0982e54f2a32023e0fc675752897c4155fdbe365c25d558113e949695512b658aa08188bf5d4428921dc77b8a4e6f5e3c84d01cc1f0e5eacbe0b65a2c8bc4937c2fa0b95bc293ed00483fa4457e975a48c49654e498c0881e0a93d25873b6818e8933a0328e0d6cfb455ad4bf2b3500aed9250e7961e8877fe730f36efa3cc3a719a7f3a020430947c0b5a7d6e69d8d8ec8d6d8b0b45d8d737e51d9f92621fd29445a9a39a06c0d4fe1dd9296edfe75372da6c6d1f889df4f0111e7cf44aa62d27601860eaca0ba3cb0c062ac33f7291ba287426ddd00116f660dbecd2962c522bc3181d19576a0501a7c65ed401d90e0616a0829eb1000acd3196d0fc5d76c15d78743a486134980".as_bytes().to_vec(),
			"f90211a0e5ecd7b8049cde14e7cc4a4db796825099124e2ffa51f8eafa690d9c880896f6a0fefc532bb1f1a5b9c9b0f87318acd6b9f9a0fe4e2eb8290cd21fd647b659641ba0268540a5a8db62078e6418034ff6895c278e4068fbe25098497626e191dc7a40a058ef6c0d7b60497aeb0a5cc91a54a947dd534a9dc14e1e30f3f054dec4ec1431a046307aa62e9d962ed7cd1695db67e06cb9a5a3ffb85a59d57892edb2d1c55b70a0bb198c4bb694d4c38445c55fceb186d04cec94464b404a1e3ed1372425cf0d82a06b9c2e9550e244014d105d45590a9685e889fd78ffe0e7776ecc17bf90932d5fa0410cd0fb3c89caace709ee28b855b96d2becb321272bfa6bc82e50ddb8a78c84a00e9d5f46fc1c0b860b093bc5173fa782763b7a16599066616d306e1b6ebec3d2a05d91559ebc497d4b723b653362aeeba8e36a6030394ed0868c44ae6a8c83e86ca090d9a92f79afb00e97f4765082aac68a02259941a7697d21bf98afd914ea4770a07b44435b87744d01a192cd79b44ee26a8cd3be86dbf397e630ca65b6380bce96a0fa3fa0759b0fd88ed22cc79ff9faa62248886a86b734197c308dc2c19877bd6fa0cc6e8817bc7131936f514342eb15f294937c6353f125c78c4a8a9eb478deabc1a0962cb80c5d3e53f795ad84a9e7112f77a22b7102f92ed90462a40bc89a56c48aa05be624dd8e997398652ee042e9e21516ecfd8b0d13c745107b6a646f2e2bfa1180".as_bytes().to_vec(),
			"f90211a017734b6b3e09a5a02f73d074361964f601a633cebe5d3941d50e2d8a7d648343a037612ac06309796493fc97503084fbb50c4fd9f7f04774b635770169ec70997ba0ddf19604b69f56fa5f545dcba901408c7155440db8cff470caec4f818283065ea039ad9ed144772ddb55a3fe624474130ad19d29333c402e4d8eb731aa2a3f8afda01a2517c3c5d814a784dc030ae3c0f842098bac5ce6c0c2d00e243d978f4e02f6a03fb6488d819ba928f66ea218b9274afe4170918a4507edcd9f1ad122b87b4548a009b158ec91c4c9493d630d1d22f59a433fe96d9c2d05b7ab0e40b5c85a7f4d70a023f35c1b3d39406a7c13f6c1676b8b184fc5f2e1a96ac6df943b3e67138cee8ea096216fe8f84885eda7972880194086f6065a67e0ee3af1111d02f62cf675b3d8a048e73745232e44dc11332bc4d44ddbc39b60d40e25217754b8f0d282d7e8fedca064cb4b394d0e0ed4e28a2cf9dd8409e0fb48017783148bd654b647415813a242a01bd63e42651f875bd4bfef0b7ea304bdeecbc9db45866450e615778084cf89cda003fe4bd31a555d9ed909c02c42137c28c8ae05d9979c536336731653811bea54a05c9c5214f6c348f622b8269c16cd83951db7abc9a723b719123451a7d8b0ec3ea0c86b70a761cf23fd81148552ef1fe096c09ef5dbbda8779f63b5a1a44eb8250ca0c29aff503291e68d4a1579fecd36704c582c0741fe82109199066cb6fb32ecac80".as_bytes().to_vec(),
			"f90211a0188286f3f11bcb771c556b5ee07c8d759c9ef472892ddc0ae9619eb3b0889405a02fd8aa6d06cb5dd3e478b8edb5a4278db6dd51f77fdf548ba0a35952d4eaeb2ca0ba7c8b8f3062acde8c7e125aded534b3a9fb54f1edc1c9a0470a53228f3f936da0f419c7c629ba79821692d00188509ceb2d41652ddfd49700241e3848e212e0caa09d8400a6f1864fdd4291104bd571cb9aca73e17f51071c8c3be9e5092a43cddba00d2ed1eaa16e5f3a5d77be1ca0ffa5a4eca19d7b952360d743ef238c93db2394a0cd13247f88437a0d238ad4684d1b95a5029a5b6673ba7ab6009f4c4a877dcb8fa0775de0434fd6f996a8e85206dd8b73de1b17bfabd5fe4ef969b44befc332a6a9a0032fea4b8402fbea7440298d655ab008898e99f843051c62adcec2db7e7651cda0607562c790d00374d1b5d28f52443258930b2dba280b34f8830819b08a7f4488a0752f7ef755ad535a4d5e91f2fdc503ac73a22e847da543b76523c44052a21a5aa010cfe1d7c9fec8afb53ee56d0162c87c1c961e6f0b0a74d1755435441a16fd86a09874f8a6b2655bbef86270ce2c28cdc5ff9bd8e5d26b18264a842f0c76ae2bcca0a9a1fc0e7fde4e76ec4f86fdd9c9bb7c199f3ca482c051b99e23735760e52c5da05df600c867e91bfd103a50dd99c386cf7dfe0a9d58c60eace62b658ce892ec40a06400d4255d478843e8e19f708bf9238b9eb4159308210390ebd0ec1596479a4280".as_bytes().to_vec(),
			"f90151a0f82991602558fd2728526111b928929bd319331752c26327b0632b1b2ebd335ea0f8f4a40c0d6f7e2721b2591668fa7ecdab457ed9b9ed119206ec7dce992543f6a060cccc874582346f9b00cf5f5f173021b7e6a261cc87f42e6554a4b5655a35d88080a068bbe85c9cf02d44cf904c054efd76d95733b70adc211531a2509ec04667ce92a0d8f69702bd1160675e32a9592da63480c4692c9ef7def82735bd611141f7ab58808080a061c279e48054785f26a0293e5d71e6dbac5d472f1e31eb1c3ba21de315f3207ca0fb165f45d07bdcdb53ebce926b1d88db216f47191c2613ebebb1cc6db0c2ff68a01a1758302cf86b012eff63c8176a71d9f8e142da3294d29befc0848275638a29a06c1f0b82f78e5cc8d7d9d464c062d538898a8d641e362846b6e14bdc565407e180a01c97e59e8a0ec38b294181d332960bb410bfa5a55431cac195c72df387a7291780".as_bytes().to_vec(),
			"f851a070fad6ec88f6bf25b4897a0bbf9cce66c5b37d2e259775cb4403f97d9e179fef80808080808080808080a0e1b81a62bde15f0f24034cad0718145079a65129120771cb78f1f1dbad60980b8080808080".as_bytes().to_vec(),
			"e39d3b9ee75012d399b185c759df602f3472b9d09b622a5ba5f48d3edb39fc84830f4240".as_bytes().to_vec()
			];

	// Call the function and check the result
	let _result = <pallet_light_verifier::Pallet<Test> as ProofVerifier>::verify_storage_proof(header, key, proof).unwrap();

});
}
